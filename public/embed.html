<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>RESG ECO Form</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/eco-form.css" />
    <style>
      /* no extra scrollbars/margins in the iframe */
      html,
      body {
        margin: 0;
        padding: 0;
        background: transparent;
      }
    </style>
  </head>
  <body>
    <div id="eco-form" data-api="/api"></div>

    <script src="/eco-form.js"></script>

    <script>
      (function () {
        function sendHeight() {
          var h =
            document.documentElement.scrollHeight ||
            document.body.scrollHeight ||
            0;

          if (window.parent) {
            // Send both formats to support different parent implementations
            window.parent.postMessage(
              {
                type: "ecoform-height",
                height: h,
              },
              "*"
            );
            window.parent.postMessage(
              {
                ecoFormHeight: h,
              },
              "*"
            );
          }
        }

        // initial + multiple delays to catch fonts/layout shifts
        window.addEventListener("load", function () {
          sendHeight();
          setTimeout(sendHeight, 100);
          setTimeout(sendHeight, 300);
          setTimeout(sendHeight, 500);
          setTimeout(sendHeight, 1000);
        });

        // Send height immediately on DOMContentLoaded too
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", sendHeight);
        } else {
          sendHeight();
        }

        // whenever the content changes size, tell the parent
        if (window.ResizeObserver) {
          var ro = new ResizeObserver(function () {
            sendHeight();
          });
          ro.observe(document.body);
          ro.observe(document.documentElement);
          // Also observe the form container
          var formEl = document.getElementById("eco-form");
          if (formEl) {
            ro.observe(formEl);
          }
        } else {
          // fallback: ping occasionally
          setInterval(sendHeight, 500);
        }

        // Also send on any mutation in the body
        if (window.MutationObserver) {
          var mo = new MutationObserver(function() {
            setTimeout(sendHeight, 50);
          });
          mo.observe(document.body, { childList: true, subtree: true });
        }
      })();
    </script>
  </body>
</html>
